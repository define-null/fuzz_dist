#!/usr/bin/env bash

docker exec \
    -it \
    -w /jepsen \
    -e MIX_ENV=prod \
    -e MIX_BUILD_ROOT=/var/jepsen/shared/fuzz_dist/_build \
    jepsen-control \
    mix release --overwrite --path /var/jepsen/shared/fuzz_dist

# docker exec -it -w /var/jepsen/shared/fuzz_dist jepsen-n1 bin/fuzz_dist daemon


docker exec \
    -it \
    jepsen-control \
    bash -c \
    'cp -r /jepsen/jepsen.fuzz_dist /var/jepsen/shared/; \
    cd /var/jepsen/shared/jepsen.fuzz_dist; \
    lein run compile'

# docker exec -it -w /var/jepsen/shared/antidote -e NODE_NAME=antidote@127.0.0.1 ROOT_DIR_PREFIX=antidote@127.0.0.1/ COOKIE=cookie jepsen-n1 bin/antidote daemon
