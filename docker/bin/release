#!/usr/bin/env bash

# build fuzz_dist from host shared volume to container shared volume
#    'rm -rf /var/jepsen/shared/fuzz_dist; \
docker exec \
    -it \
    -w /jepsen \
    -e MIX_ENV=prod \
    -e MIX_BUILD_ROOT=/var/jepsen/shared/fuzz_dist/_build \
    jepsen-control \
    bash -c \
    'mkdir /var/jepsen/shared/fuzz_dist; \
    cp -r /jepsen/* /var/jepsen/shared/fuzz_dist/; \
    cd /var/jepsen/shared/fuzz_dist; \
    mix do deps.get, release --overwrite --path /var/jepsen/shared/fuzz_dist'


# build jepsen.fuzz_dist from host shared volume to container shared volume
#    'rm -rf /var/jepsen/shared/jepsen.fuzz_dist; \
docker exec \
    -it \
    -w /jepsen \
    jepsen-control \
    bash -c \
    'cp -r /jepsen/jepsen.fuzz_dist /var/jepsen/shared/; \
    cd /var/jepsen/shared/jepsen.fuzz_dist; \
    lein run compile'
